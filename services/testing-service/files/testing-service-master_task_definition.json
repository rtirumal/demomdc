[
  {
    "name": "${name}",
    "image": "${task_image}",
    "essential": true,
    "portMappings": [
      {
        "containerPort": ${container_port},
        "hostPort": ${host_port},
        "protocol": "${protocol}"
      }
    ],
    "environment": [
      {
          "name": "env_name",
          "value": "${env_name}"
      },
      {
        "name": "aws_region",
        "value": "${aws_region}"
      },
      {
        "name": "jenkins_aws_user_id",
        "value": "${jenkins_aws_user_id}"
      },
      {
        "name": "jenkins_aws_access_key",
        "value": "${jenkins_aws_access_key}"
      },
      {
        "name": "jenkins_aws_secret_key",
        "value": "${jenkins_aws_secret_key}"
      },
      {
        "name": "agent_cluster_security_groups",
        "value": "${agent_cluster_security_groups}"
      },
      {
        "name": "agent_cluster_subnets",
        "value": "${agent_cluster_subnets}"
      },
      {
        "name": "aws_account_id",
        "value": "${aws_account_id}"
      }
  ],
    "privileged": false,
    "dockerLabels": {
      "com.datadoghq.ad.instances": "[{\"host\": \"%%host%%\", \"port\": ${container_port}]",
      "com.datadoghq.ad.check_names": "[\"ECS_FARGATE\"]",
      "com.datadoghq.ad.init_configs": "[{}]"
  },
    "memory": ${task_memory},
    "networkMode": "awsvpc",
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${log_group}",
        "awslogs-region": "${aws_region}",
        "awslogs-stream-prefix": "${service_name}"
      }
    }
  },
  {
    "name": "datadog-agent",
    "image": "datadog/agent:latest",
    "essential": true,
    "environment": [
        {
            "name": "DD_API_KEY",
            "value": "${datadog_api_key}"
        },
        {
            "name": "ECS_FARGATE",
            "value": "true"
        }
    ]
}
]

